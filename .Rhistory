)
precis(Bayes_fit_HLE_d_f)
precis(Bayes_fit_HLE_d_f) %>% as.matrix() %>% as.data.frame()
Bayes_fit_HLE_d_f<-
rethinking::map(alist(HLE~dnorm(mu, sigma),mu~beta0+beta1*F1+beta2*F2,beta0~dnorm(80, 100),beta1~dnorm(0, 10),beta2~dnorm(0, 10),sigma ~ dunif(0, 50)),
data=HLE_FF_d_f
)
Bayes_fit_HLE_d_f
precis(Bayes_fit_HLE_d_f)
precis(Bayes_fit_HLE_d_f) %>% as.matrix() %>% as.data.frame()
post<-extract.samples(Bayes_fit_HLE_d_f)
dens(post)
dens(post)
mu_at_Q2<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(75-.3, 75+.3))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(75-.3, 75+.3) +
ggtitle("健康寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[2]+ post$beta2*mean(HLE_FF_d_f$F2)
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(75-.3, 75+.3))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("健康寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(75-.3, 75+.3) +
ggtitle("健康寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[2]+ post$beta2*mean(HLE_FF_d_f$F2)
mu_at_Q3<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[3]+ post$beta2*mean(HLE_FF_d_f$F2)
mu_at_Q4<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[4]+ post$beta2*mean(HLE_FF_d_f$F2)
par(family= "HiraKakuProN-W3")
mu_at_Q2 %>% dens(col="red", main = "F1因子の寿命への影響", xlim=c(75-.3, 75+.3))
mu_at_Q3 %>% dens(col="green", main = "F1が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F1が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(75-.3, 75+.3) +
ggtitle("健康寿命のF1による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F1.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ---- Bayes : 男性、健康寿命---------------
suppressMessages(library(rethinking))
suppressMessages(library(rethinking))
Bayes_fit_HLE_d_m<-
rethinking::map(alist(HLE~dnorm(mu, sigma),mu~beta0+beta1*F1+beta2*F2,beta0~dnorm(80, 100),beta1~dnorm(0, 10),beta2~dnorm(0, 10),sigma ~ dunif(0, 50)),
data=HLE_FF_d_m
)
## ----warning=FALSE------------------------------
precis(Bayes_fit_HLE_d_m)
precis(Bayes_fit_HLE_d_m) %>% as.matrix() %>% as.data.frame()
file="Bayes_fit_HLE_d_m.tex"
post<-extract.samples(Bayes_fit_HLE_d_m)
dens(post)
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*mean(HLE_FF_d_m$F1)+ post$beta2*quantile(HLE_FF_d_m$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(HLE_FF_d_m$F1)+ post$beta2*quantile(HLE_FF_d_m$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(HLE_FF_d_m$F1)+ post$beta2*quantile(HLE_FF_d_m$F2)[4]
par(family= "HiraKakuProN-W3")
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(72-.3, 72+.3))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(72-.3, 72+.3)
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(72-.3, 72+.3) +
ggtitle("健康寿命のF2による影響、男性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_m_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(HLE_FF_d_m$F1)[2]+ post$beta2*mean(HLE_FF_d_m$F2)
mu_at_Q3<-post$beta0 + post$beta1*quantile(HLE_FF_d_m$F1)[3]+ post$beta2*mean(HLE_FF_d_m$F2)
mu_at_Q4<-post$beta0 + post$beta1*quantile(HLE_FF_d_m$F1)[4]+ post$beta2*mean(HLE_FF_d_m$F2)
par(family= "HiraKakuProN-W3")
mu_at_Q2 %>% dens(col="red", main = "F1因子の寿命への影響", xlim=c(72-.3, 72+.3))
mu_at_Q3 %>% dens(col="green", main = "F1が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F1が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(72-.3, 72+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(72-.3, 72+.3) +
ggtitle("健康寿命のF1による影響、男性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_m_ccdf_F1.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
system("open .")
## ---- Pre material ------------------------------
# |  _ \ _ __ ___|  \/  | __ _| |_ ___ _ __(_) __ _| |
# | |_) | '__/ _ \ |\/| |/ _` | __/ _ \ '__| |/ _` | |
# |  __/| | |  __/ |  | | (_| | ||  __/ |  | | (_| | |
# |_|   |_|  \___|_|  |_|\__,_|\__\___|_|  |_|\__,_|_|
## ---- Pre material ------------------------------
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
suppressMessages(library(ggrepel))
suppressMessages(library(magrittr))
suppressMessages(library(xtable))
# load("../ScreenEnd.RData")
load("ScreenEnd.RData")
options(digits = 5)              # Modify global options
## ----sink example  ------------------------------
# ____  _       _      _____
# / ___|(_)_ __ | | __ | ____|_  __
# \___ \| | '_ \| |/ / |  _| \ \/ /
#  ___) | | | | |   <  | |___ >  <
# |____/|_|_| |_|_|\_\ |_____/_/\_\
# ref for Q and A
# https://stackoverflow.com/questions/33994194/changing-the-font-size-of-table-using-print-xtable
# print(xtable(results), only.contents=TRUE, include.rownames=F,        include.colnames=T, floating=F,       hline.after=NULL, size="\\fontsize{9pt}{10pt}\\selectfont",       file = '~/Dropbox/Paper/table.tex')
## ----sink example  ------------------------------
## ----tex file sink example ------------------------------
# table tex saving folder
path="./final_report-kenko(和歌山県)/table/"
# table tex file name
file="example.tex"
sink(file = paste0(path, file))
xtable(iris[1:5, ], label = "tablelabel", caption = c(
"$\\beta_0
X_1+
\\beta_0 X_2$
寿命", "bbb")) %>% print(size="\\tiny")
sink()
# # -----------------　total variable # -----------------
#  _____     _        _  __     __    _           _     _
# |_   _|__ | |_ __ _| | \ \   / /_ _(_)_ __ __ _| |__ | | ___
#   | |/ _ \| __/ _` | |  \ \ / / _` | | '__/ _` | '_ \| |/ _ \
#   | | (_) | || (_| | |   \ V / (_| | | | | (_| | |_) | |  __/
#   |_|\___/ \__\__,_|_|    \_/ \__,_|_|_|  \__,_|_.__/|_|\___|
# # -----------------　total variable # -----------------
library(xtable)
# table 変数リスト
d_common1 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common2 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common3 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[51:75, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common4 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[76:98, ] %>%
rbind(c(NA, NA), c(NA, NA)) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_common1, d_common2[-11,], d_common3, d_common4) %>% select(2,4,6,8)
file="table_commom_d.tex"
path="./final_report-kenko(和歌山県)/table/"
sink(file = paste0(path, file))
d_common1 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common2 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common3 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[51:75, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common4 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[76:98, ] %>%
rbind(c(NA, NA), c(NA, NA)) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_common1, d_common2[-11,], d_common3, d_common4) %>% select(2,4,6,8) %>%
xtable(label = "table_commom_d.tex",
caption = c("共通変数"), digits=3) %>%
print(size = "\\tiny", caption.placement = "top")
sink()
system('
cd "./final_report-kenko(和歌山県)/table/";
sed -e "s/㎡/m$^2$/g" "table_commom_d.tex" > "table_commom_d1.tex";
rm table_commom_d.tex;
mv table_commom_d1.tex table_commom_d.tex;
python3 ../../exex.py "table_commom_d.tex" "temp.tex";
mv "temp.tex" "table_commom_d.tex"
')
rm(d_common1,d_common2,d_common3,d_common4)
library(xtable)
# table 変数リスト
d_mf
d_mf1 <- d_mf[, 7:70] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id,var_name_Jpn)
d_mf2 <- d_mf[, 7:70] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_mf3 <- d_mf[, 7:70] %>% colnames() %>% enframe() %>% .[51:64, ] %>%
rbind(
c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA),
c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA)
) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_mf1[-15,], d_mf2, d_mf3) %>% select(2,4,6)
file="table_mf_d.tex"
path="./final_report-kenko(和歌山県)/table/"
sink(file = paste0(path, file))
d_mf1 <- d_mf[, 7:70] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id,var_name_Jpn)
d_mf2 <- d_mf[, 7:70] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_mf3 <- d_mf[, 7:70] %>% colnames() %>% enframe() %>% .[51:64, ] %>%
rbind(
c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA),
c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA), c(NA, NA)
) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_mf1[-15,], d_mf2, d_mf3) %>% select(2,4,6) %>%
xtable(label = "table_mf_d.tex",
caption = c("性別変数(64個)"), digits=3) %>%
print(size = "\\tiny", caption.placement = "top")
sink()
system('
cd "./final_report-kenko(和歌山県)/table/";
sed -e "s/㎡/m$^2$/g" "table_mf_d.tex" > "table_mf_d1.tex";
rm table_mf_d.tex;
mv table_mf_d1.tex table_mf_d.tex;
python3 ../../exex.py "table_mf_d.tex" "temp.tex";
mv "temp.tex" "table_mf_d.tex"
')
rm(d_mf1,d_mf2,d_mf3)
## ---- Pre material ------------------------------
# |  _ \ _ __ ___|  \/  | __ _| |_ ___ _ __(_) __ _| |
# | |_) | '__/ _ \ |\/| |/ _` | __/ _ \ '__| |/ _` | |
# |  __/| | |  __/ |  | | (_| | ||  __/ |  | | (_| | |
# |_|   |_|  \___|_|  |_|\__,_|\__\___|_|  |_|\__,_|_|
## ---- Pre material ------------------------------
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
suppressMessages(library(ggrepel))
suppressMessages(library(magrittr))
suppressMessages(library(xtable))
# load("../ScreenEnd.RData")
load("ScreenEnd.RData")
options(digits = 5)              # Modify global options
## ----sink example  ------------------------------
# ____  _       _      _____
# / ___|(_)_ __ | | __ | ____|_  __
# \___ \| | '_ \| |/ / |  _| \ \/ /
#  ___) | | | | |   <  | |___ >  <
# |____/|_|_| |_|_|\_\ |_____/_/\_\
# ref for Q and A
# https://stackoverflow.com/questions/33994194/changing-the-font-size-of-table-using-print-xtable
# print(xtable(results), only.contents=TRUE, include.rownames=F,        include.colnames=T, floating=F,       hline.after=NULL, size="\\fontsize{9pt}{10pt}\\selectfont",       file = '~/Dropbox/Paper/table.tex')
## ----sink example  ------------------------------
## ----tex file sink example ------------------------------
# table tex saving folder
path="./final_report-kenko(和歌山県)/table/"
# table tex file name
file="example.tex"
sink(file = paste0(path, file))
xtable(iris[1:5, ], label = "tablelabel", caption = c(
"$\\beta_0
X_1+
\\beta_0 X_2$
寿命", "bbb")) %>% print(size="\\tiny")
sink()
# # -----------------　total variable # -----------------
#  _____     _        _  __     __    _           _     _
# |_   _|__ | |_ __ _| | \ \   / /_ _(_)_ __ __ _| |__ | | ___
#   | |/ _ \| __/ _` | |  \ \ / / _` | | '__/ _` | '_ \| |/ _ \
#   | | (_) | || (_| | |   \ V / (_| | | | | (_| | |_) | |  __/
#   |_|\___/ \__\__,_|_|    \_/ \__,_|_|_|  \__,_|_.__/|_|\___|
# # -----------------　total variable # -----------------
library(xtable)
# table 変数リスト
d_common1 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common2 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common3 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[51:75, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common4 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[76:98, ] %>%
rbind(c(NA, NA), c(NA, NA)) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_common1, d_common2[-11,], d_common3, d_common4) %>% select(2,4,6,8)
file="table_commom_d.tex"
path="./final_report-kenko(和歌山県)/table/"
sink(file = paste0(path, file))
d_common1 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common2 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common3 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[51:75, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common4 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[76:98, ] %>%
rbind(c(NA, NA), c(NA, NA)) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_common1, d_common2[-11,], d_common3, d_common4) %>% select(2,4,6,8) %>%
xtable(label = "table_commom_d.tex",
caption = c("共通変数(98個)"), digits=3) %>%
print(size = "\\tiny", caption.placement = "top")
sink()
system('
cd "./final_report-kenko(和歌山県)/table/";
sed -e "s/㎡/m$^2$/g" "table_commom_d.tex" > "table_commom_d1.tex";
rm table_commom_d.tex;
mv table_commom_d1.tex table_commom_d.tex;
python3 ../../exex.py "table_commom_d.tex" "temp.tex";
mv "temp.tex" "table_commom_d.tex"
')
rm(d_common1,d_common2,d_common3,d_common4)
## ---- Pre material ------------------------------
# |  _ \ _ __ ___|  \/  | __ _| |_ ___ _ __(_) __ _| |
# | |_) | '__/ _ \ |\/| |/ _` | __/ _ \ '__| |/ _` | |
# |  __/| | |  __/ |  | | (_| | ||  __/ |  | | (_| | |
# |_|   |_|  \___|_|  |_|\__,_|\__\___|_|  |_|\__,_|_|
## ---- Pre material ------------------------------
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
suppressMessages(library(ggrepel))
suppressMessages(library(magrittr))
suppressMessages(library(xtable))
# load("../ScreenEnd.RData")
load("ScreenEnd.RData")
options(digits = 5)              # Modify global options
## ----sink example  ------------------------------
# ____  _       _      _____
# / ___|(_)_ __ | | __ | ____|_  __
# \___ \| | '_ \| |/ / |  _| \ \/ /
#  ___) | | | | |   <  | |___ >  <
# |____/|_|_| |_|_|\_\ |_____/_/\_\
# ref for Q and A
# https://stackoverflow.com/questions/33994194/changing-the-font-size-of-table-using-print-xtable
# print(xtable(results), only.contents=TRUE, include.rownames=F,        include.colnames=T, floating=F,       hline.after=NULL, size="\\fontsize{9pt}{10pt}\\selectfont",       file = '~/Dropbox/Paper/table.tex')
## ----sink example  ------------------------------
## ----tex file sink example ------------------------------
# table tex saving folder
path="./final_report-kenko(和歌山県)/table/"
# table tex file name
file="example.tex"
sink(file = paste0(path, file))
xtable(iris[1:5, ], label = "tablelabel", caption = c(
"$\\beta_0
X_1+
\\beta_0 X_2$
寿命", "bbb")) %>% print(size="\\tiny")
sink()
# # -----------------　total variable # -----------------
#  _____     _        _  __     __    _           _     _
# |_   _|__ | |_ __ _| | \ \   / /_ _(_)_ __ __ _| |__ | | ___
#   | |/ _ \| __/ _` | |  \ \ / / _` | | '__/ _` | '_ \| |/ _ \
#   | | (_) | || (_| | |   \ V / (_| | | | | (_| | |_) | |  __/
#   |_|\___/ \__\__,_|_|    \_/ \__,_|_|_|  \__,_|_.__/|_|\___|
# # -----------------　total variable # -----------------
library(xtable)
# table 変数リスト
d_common1 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common2 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common3 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[51:75, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common4 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[76:98, ] %>%
rbind(c(NA, NA), c(NA, NA)) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_common1, d_common2[-11,], d_common3, d_common4) %>% select(2,4,6,8)
file="table_commom_d.tex"
path="./final_report-kenko(和歌山県)/table/"
sink(file = paste0(path, file))
d_common1 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[1:25, ] %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common2 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[26:50, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common3 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[51:75, ]  %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
d_common4 <- d_common[, 7:104] %>% colnames() %>% enframe() %>% .[76:98, ] %>%
rbind(c(NA, NA), c(NA, NA)) %>%
left_join(var, by=c("value"="var_name_Eng")) %>% select(id, var_name_Jpn)
bind_cols(d_common1, d_common2[-11,], d_common3, d_common4) %>% select(2,4,6,8) %>%
xtable(label = "table_commom_d.tex",
caption = c("共通変数(98個)"), digits=3) %>%
print(size = "\\tiny", caption.placement = "top")
sink()
system('
cd "./final_report-kenko(和歌山県)/table/";
sed -e "s/㎡/m$^2$/g" "table_commom_d.tex" > "table_commom_d1.tex";
rm table_commom_d.tex;
mv table_commom_d1.tex table_commom_d.tex;
python3 ../../exex.py "table_commom_d.tex" "temp.tex";
mv "temp.tex" "table_commom_d.tex"
')
rm(d_common1,d_common2,d_common3,d_common4)
f_var=LE_d_f_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(f_var=var_name_Jpn) %>% .[-1, ]
m_var=LE_d_m_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(m_var=var_name_Jpn) %>% .[-1, ]
m_var %<>% bind_rows(as.data.frame(rep(NA, 7)))
m_var %<>% select(1)
# table tex file name
file="UsedVar.tex"
sink(file = paste0(path, file))
f_var %>%
bind_cols(m_var) %>%
xtable(label = "UsedVariable",
caption = c("$\\beta_0 X_1+\\beta_0 X_2$寿命",
"bbb")) %>%
print(size = "\\tiny", caption.placement = "top")
sink()
system('
cd "./final_report-kenko(和歌山県)/table/";
sed -e "s/㎡/m$^2$/g" "UsedVar.tex" > "UsedVar1.tex";
rm UsedVar.tex;
mv UsedVar1.tex UsedVar.tex;
python3 ../../exex.py "UsedVar.tex" "temp.tex";
mv "temp.tex" "UsedVar.tex"
')
f_var=LE_d_f_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(f_var=var_name_Jpn) %>% .[-1, ]
m_var=LE_d_m_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(m_var=var_name_Jpn) %>% .[-1, ]
m_var %<>% bind_rows(as.data.frame(rep(NA, 7)))
m_var %<>% select(1)
# table tex file name
file="UsedVar.tex"
sink(file = paste0(path, file))
f_var %>%
bind_cols(m_var) %>%
xtable(label = "UsedVariable",
caption = c("変数選択後の変数")) %>%
print(size = "\\tiny", caption.placement = "top")
sink()
system('
cd "./final_report-kenko(和歌山県)/table/";
sed -e "s/㎡/m$^2$/g" "UsedVar.tex" > "UsedVar1.tex";
rm UsedVar.tex;
mv UsedVar1.tex UsedVar.tex;
python3 ../../exex.py "UsedVar.tex" "temp.tex";
mv "temp.tex" "UsedVar.tex"
')
