1+2 # cmd(ctrl)+enter
1+2 # cmd(ctrl)+enter
rnorm(5)
runif(5)
runif(100)
a <- runif(100) # object
a
plot(a)
plot(a)
reticulate::repl_python()
print("hello world")
y
Wakayama::d_common
Wakayama::d_common %>% colnames()
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
Wakayama::d_common %>% colnames()
system("open .")
system("open .")
system("open .")
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(file),skip=1, locale = readr::locale(encoding = "CP932"))
suppressMessages(library(tidyverse))
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(file),skip=1, locale = readr::locale(encoding = "CP932"))
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))
d_health_care
d_health_care
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1)
d_health_care
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:4,5)
d_health_care
d_health_care
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7)
d_health_care
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter_if(is.na(関係団体会員数))
d_health_care
read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter_if(is.na(関係団体会員数))
d_health_care
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter_if(is.na(関係団体会員数))
d_health_care
d_health_care %>% colnames()
d_health_care %>% colnames() %>% cat
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter_if(is.na(関係団体会員数))
d_health_care
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(is.na(関係団体会員数))
d_health_care
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(!is.na(関係団体会員数))
d_health_care
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat.csv"
d<-read_csv(url(file),skip=1, locale = readr::locale(encoding = "CP932"))
d<-d[-95,]
d<-d %>% rename(key=X1)
d %>% dim()
head(d)
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(!is.na(関係団体会員数))
d_health_care
JpnEng<-"https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/JpnEng.csv"
JpnEng<-read_csv(url(JpnEng))
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat.csv"
d<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))
d<-d[-95,]
d<-d %>% rename(key=X1)
d %>% dim()
head(d)
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(!is.na(関係団体会員数))
d_health_care
JpnEng<-"https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/JpnEng.csv"
JpnEng<-read_csv(url(JpnEng))
ls()
d
d_health_care
JpnEng
system("open .")
d %>% dim()
d %>% dim()
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat.csv"
d<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))
d<-d[-95,]
d<-d %>% rename(key=X1)
d %>% dim()
head(d)
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(!is.na(関係団体会員数))
d_health_care
JpnEng<-"https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/JpnEng.csv"
JpnEng<-read_csv(url(JpnEng))
d
d_health_care
JpnEng
d %>% dim()
d %>% head()
d %>% colnames()
JpnEng
JpnEng %>% DT::datatable()
JpnEng %>% DT::datatable()
d[, sapply(d[48,], is.na)]
d
d_common<-d[, sapply(d[48,], is.na)]
d_common<-d_common[1:47, ]
d_common<-d %>% select(1:6) %>% .[1:47,] %>% bind_cols(d_common)
d_common %>% DT::datatable()
d_common
colnames(d)<-JpnEng$var_name_Eng
d
JpnEng %>% DT::datatable()
d_common<-d[, sapply(d[48,], is.na)]
d_common<-d_common[1:47, ]
d_common<-d %>% select(1:6) %>% .[1:47,] %>% bind_cols(d_common)
d_common %>% DT::datatable()
d_common
name <- function(x) {
!is.na(x)
}
d_mf<-d[, sapply(d[48,], name)]
d_mf %>% DT::datatable()
d_mf
name <- function(x) {
!is.na(x)
}
d_mf<-d[, sapply(d[48,], name)]
d_mf %>% DT::datatable()
d_m %>% DT::datatable()
suppressMessages(library(plotly))
t<-d_m %>% select(pref.J,HLE_2016,LE_2015) %>%
mutate(pref.J=forcats::fct_reorder(pref.J, LE_2015))
t
d_m %>% select(pref.J,HLE_2016,LE_2015) %>%
mutate(pref.J=forcats::fct_reorder(pref.J, LE_2015))
d_m<-d_mf %>% filter(sex=="M")
d_f<-d_mf %>% filter(sex=="F")
d_m %>% DT::datatable()
suppressMessages(library(plotly))
t<-d_m %>% select(pref.J,HLE_2016,LE_2015) %>%
mutate(pref.J=forcats::fct_reorder(pref.J, LE_2015))
t$pref.J
t %>%
plot_ly() %>%
add_segments(
x=~HLE_2016,y=~pref.J ,
xend=~LE_2015,yend=~pref.J ,
# x = ~c, y = ~model,
# xend = ~h, yend = ~model,
color = I("gray"), showlegend = FALSE
) %>%
add_markers(
# x = ~c, y = ~model,
x=~HLE_2016,y=~pref.J ,
color = I("blue"),
name = "健康寿命"
) %>%
add_markers(
# x = ~h, y = ~model,
x=~LE_2015,y=~pref.J ,
color = I("red"),
name  = "平均寿命"
) %>%
layout(
xaxis = list(
range=c(60,83),
title="男性の平均寿命と健康寿命の差"
)
)
# 5.2 女性の平均寿命と健康寿命の差
suppressMessages(library(plotly))
t<-d_f %>% select(pref.J,HLE_2016,LE_2015) %>%
mutate(pref.J=forcats::fct_reorder(pref.J, LE_2015))
t$pref.J
t<-d_f %>% select(pref.J,HLE_2016,LE_2015) %>%
mutate(pref.J=forcats::fct_reorder(pref.J, LE_2015))
t$pref.J
t %>%
# plot_ly(width = 600, height = 1000) %>%
plot_ly() %>%
add_segments(
x=~HLE_2016,y=~pref.J ,
xend=~LE_2015,yend=~pref.J ,
# x = ~c, y = ~model,
# xend = ~h, yend = ~model,
color = I("gray"), showlegend = FALSE
) %>%
add_markers(
# x = ~c, y = ~model,
x=~HLE_2016,y=~pref.J ,
color = I("blue"),
name = "健康寿命"
) %>%
add_markers(
# x = ~h, y = ~model,
x=~LE_2015,y=~pref.J ,
color = I("red"),
name  = "平均寿命"
) %>%
layout(
xaxis = list(
range=c(60,88),
title="女性の平均寿命と健康寿命の差"
)
)
jc.dotplot <- function(x) {
# x is HLE or LE in c()　vector
names(x)<-Wakayama::pref$pref.J
x<-x[order(x)]
}
colfunc <- colorRampPalette(c("gray90","black"))
dotchart(
main = "平均寿命(2015年, 男性)",
jc.dotplot(d_m$LE_2015),
cex = 0.7,
lcolor = "gray90",
pch = 19,
col = colfunc(47),
pt.cex = 1.5
)
abline(v = mean(d_m$LE_2015), lty = 2)
par(family= "HiraKakuProN-W3")
dotchart(
main = "平均寿命(2015年, 男性)",
jc.dotplot(d_m$LE_2015),
cex = 0.7,
lcolor = "gray90",
pch = 19,
col = colfunc(47),
pt.cex = 1.5
)
abline(v = mean(d_m$LE_2015), lty = 2)
# 5.4 男性の健康寿命
# Hide
d_m %>% select(HLE_2016) %>% bind_cols(Wakayama::pref["pref.J"]) %>% dplyr::arrange(HLE_2016) %>% mutate(rank=row_number()) %>%DT::datatable()
jc.dotplot <- function(x) {
# x is HLE or LE in c()　vector
names(x)<-Wakayama::pref$pref.J
x<-x[order(x)]
}
colfunc <- colorRampPalette(c("gray90","black"))
par(family= "HiraKakuProN-W3")
dotchart(
main = "健康寿命(2016年, 男性)",
jc.dotplot(d_m$HLE_2016),
cex = 0.7,
lcolor = "gray90",
pch = 19,
col = colfunc(47),
pt.cex = 1.5
)
abline(v = mean(d_m$HLE_2016), lty = 2)
d_m$HLE_2016
mean(d_m$HLE_2016)
d_f %>% select(LE_2015) %>% bind_cols(Wakayama::pref["pref.J"]) %>% dplyr::arrange(LE_2015) %>% mutate(rank=row_number()) %>%DT::datatable()
d_f %>% select(LE_2015) %>% bind_cols(Wakayama::pref["pref.J"]) %>% dplyr::arrange(LE_2015) %>% mutate(rank=row_number()) %>%DT::datatable()
jc.dotplot <- function(x) {
# x is HLE or LE in c()　vector
names(x)<-Wakayama::pref$pref.J
x<-x[order(x)]
}
colfunc <- colorRampPalette(c("gray90","black"))
par(family= "HiraKakuProN-W3")
dotchart(
main = "平均寿命(2015年, 女性)",
jc.dotplot(d_f$LE_2015),
cex = 0.7,
lcolor = "gray90",
pch = 19,
col = colfunc(47),
pt.cex = 1.5
)
abline(v = mean(d_f$LE_2015), lty = 2)
jc.dotplot <- function(x) {
# x is HLE or LE in c()　vector
names(x)<-Wakayama::pref$pref.J
x<-x[order(x)]
}
colfunc <- colorRampPalette(c("gray90","black"))
par(family= "HiraKakuProN-W3")
dotchart(
main = "平均寿命(2015年, 女性)",
jc.dotplot(d_f$HLE_2016),
cex = 0.7,
lcolor = "gray90",
pch = 19,
col = colfunc(47),
pt.cex = 1.5
)
abline(v = mean(d_f$HLE_2016), lty = 2)
d_common %>% dplyr::select_if(is.numeric) %>% sapply(rank) %>%
tbl_df() %>%dplyr::filter(key==30) %>% t() %>% as.data.frame() %>% DT::datatable()
suppressMessages(library(plotly))
d_common_standarize<-
d_common %>% dplyr::select_if(is.numeric) %>%
select(-key, -pref.id) %>% scale() %>% tbl_df()
d_common_standarize<-bind_cols(d_common["pref.id"], d_common_standarize)
d_common_standarize_long<-
d_common_standarize %>% dplyr::select_if(is.numeric) %>%
pivot_longer(
cols = -pref.id,
names_to ="var_name" ,
values_to ="value"
)
plot_ly(
x =d_common_standarize_long$value,
type = "histogram",
name = "Histogram",
frame =  ~d_common_standarize_long$var_name
)
d_common_standarize_long
JpnEng
d_common_standarize_long %>% left_join(JpnEng, c("var_name"="var_name_Eng"))
d_common_standarize_long<-
d_common_standarize_long %>% left_join(JpnEng, c("var_name"="var_name_Eng"))
d_common_standarize_long<-
d_common_standarize %>% dplyr::select_if(is.numeric) %>%
pivot_longer(
cols = -pref.id,
names_to ="var_name" ,
values_to ="value"
)
d_common_standarize_long<-
d_common_standarize_long %>% left_join(JpnEng, c("var_name"="var_name_Eng"))
d_common_standarize_long
plot_ly(
x =d_common_standarize_long$value,
type = "histogram",
name = "Histogram",
frame =  ~d_common_standarize_long$var_name,
text=d_common_standarize_long$var_name_Jpn
)
plot_ly(
x =d_common_standarize_long$value,
type = "histogram",
name = "Histogram",
# frame =  ~d_common_standarize_long$var_name,
frame =  ~d_common_standarize_long$var_name_Jpn,
text=d_common_standarize_long$var_name_Jpn
)
# 6.3 d_common dataの連続データ分布確認2
# Hide
name1 <- function(temp) {
temp %>% select(value) %>% .[[1]] %>% density() %>%
broom::tidy()
}
d_common_standarize_long_density<-
d_common_standarize_long %>% group_by(var_name) %>% nest() %>% mutate(dens=map(data, name1)) %>% select(var_name, dens) %>% unnest()
d_common_standarize_long_density
d_common_standarize_long
d_common_standarize_long_density<-
d_common_standarize_long %>% group_by(var_name_Jpn) %>% nest() %>% mutate(dens=map(data, name1)) %>% select(var_name, dens) %>% unnest()
d_common_standarize_long_density
d_common_standarize_long_density
d_common_standarize_long_density<-
d_common_standarize_long %>% group_by(var_name_Jpn) %>% nest() %>% mutate(dens=map(data, name1)) %>% select(var_name, dens) %>% unnest()
d_common_standarize_long_density<-
d_common_standarize_long %>%
group_by(var_name_Jpn) %>% nest() %>%
mutate(dens=map(data, name1)) %>%
select(var_name_Jpn, dens) %>% unnest()
d_common_standarize_long_density
d_common_standarize_long_density %>%
plot_ly(x=~x, y=~y) %>%
# add_lines(frame=~var_name)
add_lines(frame=~var_name,
text = ~paste(var_name_Jpn),
hoverinfo = "text"
) %>%
layout(title="分布")
d_common_standarize_long_density %>%
plot_ly(x=~x, y=~y) %>%
# add_lines(frame=~var_name)
add_lines(frame=~var_name_Jpn,
text = ~paste(var_name_Jpn),
hoverinfo = "text"
) %>%
layout(title="分布")
d_common_standarize_long_density %>%
plot_ly(x=~x, y=~y) %>%
# add_lines(frame=~var_name)
add_lines(frame=~var_name_Jpn,
text = ~paste(var_name_Jpn),
hoverinfo = "text"
) %>%
layout(title="分布")
# 6.4 d_common dataの連続データの正規性検定
# shapiro 検定
# Hide
jc_shapiro <- function(x) {
shapiro.test(x) %>% broom::tidy() %>% select(p.value) %>% round(3)
}
d_common_normality_test<-d_common %>% dplyr::select_if(is.numeric) %>%
select(-key, -pref.id) %>%
# scale() %>%
tbl_df() %>% purrr::map_df(jc_shapiro)
rownames(d_common_normality_test)<-d_common %>% dplyr::select_if(is.numeric) %>%
select(-key, -pref.id) %>% colnames()
DT::datatable(d_common_normality_test)
d_common_normality_test %>%
filter(p.value<0.05) %>% DT::datatable()
d_common_normality_test
d_common_normality_test %>% colnames()
d_common_normality_test %>% rownames()
d_common_normality_test %>% rownames_to_column()
d_common_normality_test %>% rownames_to_column() %>%
filter(p.value<0.05) %>%  left_join(JpnEng, c("rowname"="var_name_Jpn"))
d_common_normality_test %>% rownames_to_column() %>%
filter(p.value<0.05) %>%  left_join(JpnEng, c("rowname"="var_name_Epn"))
d_common_normality_test %>% rownames_to_column() %>%
filter(p.value<0.05) %>%  left_join(JpnEng, c("rowname"="var_name_Eng"))
d_common_normality_test %>% rownames_to_column() %>%
filter(p.value<0.05) %>%  left_join(JpnEng, c("rowname"="var_name_Eng")) %>% %>% DT::datatable()
source('~/Dropbox/00000健康和歌山県/0 wakayamaPkg/R/mid_prentation.R')
d_common_normality_test %>% rownames_to_column() %>%
filter(p.value < 0.05) %>%  left_join(JpnEng, c("rowname" = "var_name_Eng")) %>%
DT::datatable()
source('~/.active-rstudio-document', echo=TRUE)
system("open .")
devtools::load_all(".")
d %>% DT::datatable()
d %>% colnames() %>% cat()
d_common
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat.csv"
d<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))
d<-d[-95,]
d<-d %>% rename(key=X1)
d %>% dim()
d %>% head()
d %>% colnames() %>% cat()
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(!is.na(関係団体会員数))
d_health_care %>% head()
JpnEng<-"https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/JpnEng.csv"
JpnEng<-read_csv(url(JpnEng))
JpnEng %>% head()
d %>% dim()
d %>% head()
d %>% colnames()
colnames(d)<-JpnEng$var_name_Eng
JpnEng %>% .[5:168, ]
d_common<-d[, sapply(d[48,], is.na)]
d_common<-d_common[1:47, ]
d_common<-d %>% select(1:6) %>% .[1:47,] %>% bind_cols(d_common)
# d_common %>% DT::datatable()
View(d_common)
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat.csv"
d<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))
d<-d[-95,]
d<-d %>% rename(key=X1)
d %>% dim()
d %>% head()
d %>% colnames() %>% cat()
addr="https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/DataFormat3(HealthCare).csv"
d_health_care<-read_csv(url(addr),skip=1, locale = readr::locale(encoding = "CP932"))%>% rename(key=X1) %>%
select(1:5,7) %>% filter(!is.na(関係団体会員数))
d_health_care %>% head()
JpnEng<-"https://raw.githubusercontent.com/luka3117/ClassData/master/Wakayama/JpnEng.csv"
JpnEng<-read_csv(url(JpnEng))
JpnEng %>% head()
d %>% dim()
d %>% head()
d %>% colnames()
colnames(d)<-JpnEng$var_name_Eng
JpnEng %>% .[5:168, ]
d_common<-d[, sapply(d[48,], is.na)]
d_common<-d_common[1:47, ]
# d_common<-d %>% select(1:6) %>% .[1:47,] %>% bind_cols(d_common)
# d_common %>% DT::datatable()
d_common%>% head()
