# [12] "Num_of_general_clinics"
# [13] "Travel_Rate"
# [14] "HM_Num_of_public_health_nurses_per_100k_pop"
# [15] "Household_Savings"
# [16] "Household_Car_ownership_quantity"
# [17] "pop_Household_Ratio_of_elderly_single_person_households"
# [18] "Meat_2014"
# [19] "barrier_free_wheelchairs_pass_Width"
# [20] "Total_working_hours_2016"
# [21] "Total_salary_2016"
# [22] "Fish_meat_consumption_avg_2014_2016"
# [23] "Bone_density_disorder_2014"
# [24] "Treatment_rate_Hospitalization_Cerebrovascular_dz_2017"
# [25] "Treatment_rate_outpatient_heart_dz_2017"
# [26] "Num_of_hospitals_2019"
# [27] "Labor_primary_industry_emp_ratio"
# [28] "Residence_sewerage_ratio"
# [29] "Residence_Num_of_city_parks"
# [30] "Residence_simachi_pavement_rate"
# [31] "Household_Tablet_terminal_Ownership_quantity"
# [32] "Hypertension_Outpatient_2014"
# [33] "Diabetes_hospitalization_2014"
# [34] "Usual_barrier_free_rate_2018"
# [35] "High_barrier_free_rate_2018"
# [36] "High_barrier_free_handrails_2018"
# [37] "Academic_ability_middle_school_2015"
# [38] "Alzheimer_dz_2014"
LE_d_m_2<-LE_d_m_2 %>% select(-Malignant_neoplasm_breast_mortality_rate_2015,-Malignant_neoplasm_uterus_mortality_rate_2015)
HLE_d_m_2<-HLE_d_m_2 %>% select(-Malignant_neoplasm_breast_mortality_rate_2015,-Malignant_neoplasm_uterus_mortality_rate_2015)
t17<-lm(LE_2015~. , data = LE_d_m_1) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<.01) %>% select(term)
t18<-lm(LE_2015~. , data = LE_d_m_2) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<.01) %>% select(term)
t19<-lm(HLE_2016~. , data = HLE_d_m_1) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<.01) %>% select(term)
t20<-lm(HLE_2016~. , data = HLE_d_m_2) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<.01) %>% select(term)
bind_rows(t17,t18,t19,t20) %>% unique() %>% .$term %>% c()
# selected 28 variables lists with male data
#
# [2] "Mortality_Malignant_Neoplasm_2018_Under_75"
# [3] "Under_75_Adjusted_Mortality_Evil_Neoplasms_2019"
# [4] "mortality_heart_dz_2015"
# [5] "Sports_Activity_rate_walking"
# [6] "Tourism_Rate"
# [7] "Volunteer_for_Persons_with_Disabilities"
# [8] "Cerebrovascular_mortality_2015"
# [9] "Malignant_neoplasm_intestine_mortality_rate_2015"
# [10] "Malignant_neoplasm_liver_mortality_rate_2015"
# [11] "Pneumonia_mortality_2015"
# [12] "Use_blood_pressure_binary_2014"
# [13] "Physical_activity_walking_binary_2014"
# [14] "Sweat_exercise_twice_a_week_binary_2014"
# [15] "Smoking_over_100_binary_2014"
# [16] "Drinking_2_or_more_per_day_binary_2014"
# [17] "Skip_breakfast_three_times_a_week_binary_2014"
# [18] "Vegetable_intake_2016"
# [19] "BMI_2016"
# [20] "mortality_cerebrovascular_dz_2015"
# [21] "Read_rate_2016"
# [22] "Volunteer_health_and_medical"
# [23] "Volunteer_for_Children"
# [24] "Hobbies_Total"
# [25] "Self_development_art_culture"
# [26] "Self_development_languages_other_than_Eng"
# [27] "Self_development_PC_etc"
# [28] "Volunteer_environmental_activities"
# ----------------- ----------------- ----------------- -----------------
#  __     __         _       _     _
#  \ \   / /_ _ _ __(_) __ _| |__ | | ___
#   \ \ / / _` | '__| |/ _` | '_ \| |/ _ \
#    \ V / (_| | |  | | (_| | |_) | |  __/
#     \_/ \__,_|_|  |_|\__,_|_.__/|_|\___|
#
#  ____       _           _   _
# / ___|  ___| | ___  ___| |_(_) ___  _ __
# \___ \ / _ \ |/ _ \/ __| __| |/ _ \| '_ \
# ___) |  __/ |  __/ (__| |_| | (_) | | | |
# |____/ \___|_|\___|\___|\__|_|\___/|_| |_|
#
# _____ _   _ ____
# | ____| \ | |  _ \
# |  _| |  \| | | | |
# | |___| |\  | |_| |
# |_____|_| \_|____/
# ----------------- ----------------- ----------------- -----------------
#  女性データ処理
tt<-bind_rows(t1,t2,t3,t4,t5,t6) %>% unique() %>% .$term %>% .[-1]
LE_d_common_f_selected<-LE_d_common_f %>% select(LE_2015, tt)
HLE_d_common_f_selected<-HLE_d_common_f %>% select(HLE_2016, tt)
tt<-bind_rows(t7,t8,t9,t10)%>% unique() %>% .$term %>% .[-1]
LE_d_f_selected<-LE_d_f %>% select(LE_2015, tt)
HLE_d_f_selected<-HLE_d_f %>% select(HLE_2016, tt)
#  男性データ処理
tt<-bind_rows(t11,t12,t13,t14,t15,t16) %>% unique() %>% .$term %>% .[-1]
LE_d_common_m_selected<-LE_d_common_m %>% select(LE_2015, tt)
HLE_d_common_m_selected<-HLE_d_common_m %>% select(HLE_2016, tt)
tt<-bind_rows(t17,t18,t19,t20)%>% unique() %>% .$term %>% .[-1]
LE_d_m_selected<-LE_d_m %>% select(LE_2015, tt)
HLE_d_m_selected<-HLE_d_m %>% select(HLE_2016, tt)
LE_d_f_with_selected <- bind_cols(LE_d_common_f_selected, LE_d_f_selected[,-1])
HLE_d_f_with_selected <- bind_cols(HLE_d_common_f_selected, HLE_d_f_selected[,-1])
LE_d_m_with_selected <- bind_cols(LE_d_common_m_selected, LE_d_m_selected[,-1])
HLE_d_m_with_selected <- bind_cols(HLE_d_common_m_selected, HLE_d_m_selected[,-1])
LE_d_f_with_selected %>% dim()
HLE_d_f_with_selected %>% dim()
LE_d_m_with_selected %>% dim()
HLE_d_m_with_selected %>% dim()
# ----------------- ----------------- ----------------- -----------------
#  ____            _   ____                           _
# |___ \ _ __   __| | / ___|  ___ _ __ ___  ___ _ __ (_)_ __   __ _
#   __) | '_ \ / _` | \___ \ / __| '__/ _ \/ _ \ '_ \| | '_ \ / _` |
#  / __/| | | | (_| |  ___) | (__| | |  __/  __/ | | | | | | | (_| |
# |_____|_| |_|\__,_| |____/ \___|_|  \___|\___|_| |_|_|_| |_|\__, |
#                                                             |___/
# ----------------- ----------------- ----------------- -----------------
# ----------------- ----------------- ----------------- -----------------
# __     ___    ____    ____  _____ _                _ _   _
# \ \   / / \  |  _ \  / ___|| ____| |     __      _(_) |_| |__
#  \ \ / / _ \ | |_) | \___ \|  _| | |     \ \ /\ / / | __| '_ \
#   \ V / ___ \|  _ <   ___) | |___| |___   \ V  V /| | |_| | | |
#   \_/_/   \_\_| \_\ |____/|_____|_____|   \_/\_/ |_|\__|_| |_|
# ----------------- ----------------- ----------------- -----------------
# LE_d_common_f$
# bind_rows(t1,t2,t3,t4,t5,t6) %>% unique() %>% .$term %>% c()
#  _____ _____ __  __    _    _     _____
# |  ___| ____|  \/  |  / \  | |   | ____|
# | |_  |  _| | |\/| | / _ \ | |   |  _|
# |  _| | |___| |  | |/ ___ \| |___| |___
# |_|   |_____|_|  |_/_/   \_\_____|_____|
#
# p value less than .01 is deleted
lm(LE_2015~., data=LE_d_f_with_selected[,c(1, 2:30)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)
lm(LE_2015~., data=LE_d_f_with_selected[,c(1, 31:62)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)
lm(HLE_2016~., data=HLE_d_f_with_selected[,c(1, 2:30)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)
lm(HLE_2016~., data=HLE_d_f_with_selected[,c(1, 31:62)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)
temp1 <- lm(LE_2015~., data=LE_d_f_with_selected[,c(1, 2:30)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)%>%select(term)
temp2 <- lm(LE_2015~., data=LE_d_f_with_selected[,c(1, 31:62)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)%>%select(term)
temp3 <- lm(HLE_2016~., data=HLE_d_f_with_selected[,c(1, 2:30)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)%>%select(term)
temp4 <- lm(HLE_2016~., data=HLE_d_f_with_selected[,c(1, 31:62)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)%>%select(term)
tt<-bind_rows(temp1, temp2, temp3, temp4) %>% unique() %>% .[-1, ] %>% .$term %>% as.vector()
LE_d_f_with_selected_2nd_screen <- LE_d_common_f %>% bind_cols(LE_d_f[,-1]) %>% select(LE_2015, tt)
HLE_d_f_with_selected_2nd_screen <- HLE_d_common_f %>% bind_cols(HLE_d_f[,-1]) %>% select(HLE_2016, tt)
#  __  __    _    _     _____
# |  \/  |  / \  | |   | ____|
# | |\/| | / _ \ | |   |  _|
# | |  | |/ ___ \| |___| |___
# |_|  |_/_/   \_\_____|_____|
#
# p value less than .01 is deleted
lm(LE_2015~., data=LE_d_m_with_selected[,c(1, 2:32)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)
lm(LE_2015~., data=LE_d_m_with_selected[,c(1, 33:65)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)
lm(HLE_2016~., data=HLE_d_m_with_selected[,c(1, 2:32)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)
lm(HLE_2016~., data=HLE_d_m_with_selected[,c(1, 33:65)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)
temp1 <- lm(LE_2015~., data=LE_d_m_with_selected[,c(1, 2:32)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)%>%select(term)
temp2 <- lm(LE_2015~., data=LE_d_m_with_selected[,c(1, 33:65)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)%>%select(term)
temp3 <- lm(HLE_2016~., data=HLE_d_m_with_selected[,c(1, 2:32)]) %>% MASS::stepAIC() %>% broom::tidy() %>% filter(p.value<0.01)%>%select(term)
temp4 <- lm(HLE_2016~., data=HLE_d_m_with_selected[,c(1, 33:65)]) %>% MASS::stepAIC() %>% broom::tidy()%>% filter(p.value<0.01)%>%select(term)
tt<-bind_rows(temp1, temp2, temp3, temp4) %>% unique() %>% .[-1, ] %>% .$term %>% as.vector()
LE_d_m_with_selected_2nd_screen <- LE_d_common_m %>% bind_cols(LE_d_m[,-1]) %>% select(LE_2015, tt)
HLE_d_m_with_selected_2nd_screen <-HLE_d_common_m %>% bind_cols(HLE_d_m[,-1]) %>% select(HLE_2016, tt)
LE_d_f_with_selected_2nd_screen %>% colnames()
LE_d_m_with_selected_2nd_screen %>% colnames()
HLE_d_f_with_selected_2nd_screen %>% colnames()
HLE_d_m_with_selected_2nd_screen %>% colnames()
# ----------------- ----------------- ----------------- -----------------
#  ____            _   ____                           _
# |___ \ _ __   __| | / ___|  ___ _ __ ___  ___ _ __ (_)_ __   __ _
#   __) | '_ \ / _` | \___ \ / __| '__/ _ \/ _ \ '_ \| | '_ \ / _` |
#  / __/| | | | (_| |  ___) | (__| | |  __/  __/ | | | | | | | (_| |
# |_____|_| |_|\__,_| |____/ \___|_|  \___|\___|_| |_|_|_| |_|\__, |
#                                                             |___/
# ----------------- ----------------- ----------------- -----------------
# _____ _   _ ____
#| ____| \ | |  _ \
#|  _| |  \| | | | |
#| |___| |\  | |_| |
#|_____|_| \_|____/
#
# ----------------- ----------------- ----------------- -----------------
# ----------------- ----------------- ----------------- -----------------
#  ____          _   ____                           _
# |___ / _ __ __| | / ___|  ___ _ __ ___  ___ _ __ (_)_ __   __ _
#   |_ \| '__/ _` | \___ \ / __| '__/ _ \/ _ \ '_ \| | '_ \ / _` |
#  ___) | | | (_| |  ___) | (__| | |  __/  __/ | | | | | | | (_| |
# |____/|_|  \__,_| |____/ \___|_|  \___|\___|_| |_|_|_| |_|\__, |
#                                                           |___/
# ----------------- ----------------- ----------------- -----------------
# Work with this for obj
# 令和3年5月21日
# 4 obj after 2nd screen
LE_d_f_with_selected_2nd_screen #
LE_d_m_with_selected_2nd_screen
HLE_d_f_with_selected_2nd_screen
HLE_d_m_with_selected_2nd_screen
# 2nd screen data dim info
LE_d_f_with_selected_2nd_screen %>% dim()  # 47 28
HLE_d_f_with_selected_2nd_screen %>% dim()  # 47 28
LE_d_m_with_selected_2nd_screen %>% dim()  # 47 20
HLE_d_m_with_selected_2nd_screen %>% dim()  # 47 20
# 3rd screening start
#  _____ _____ __  __    _    _     _____
# |  ___| ____|  \/  |  / \  | |   | ____|
# | |_  |  _| | |\/| | / _ \ | |   |  _|
# |  _| | |___| |  | |/ ___ \| |___| |___
# |_|   |_____|_|  |_/_/   \_\_____|_____|
#
lm(LE_2015~., data = LE_d_f_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
lm(HLE_2016~., data = HLE_d_f_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
temp1 <- lm(LE_2015~., data = LE_d_f_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
temp2 <- lm(HLE_2016~., data = HLE_d_f_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
tt<-bind_rows(temp1[-1, ], temp2[-1, ]) %>% .$term %>%unique() %>%  as.vector()
LE_d_f_with_selected_3rd_screen <- LE_d_common_f %>% bind_cols(LE_d_f[,-1]) %>% select(LE_2015, tt)
HLE_d_f_with_selected_3rd_screen <-HLE_d_common_f %>% bind_cols(HLE_d_f[,-1]) %>% select(HLE_2016, tt)
#  __  __    _    _     _____
# |  \/  |  / \  | |   | ____|
# | |\/| | / _ \ | |   |  _|
# | |  | |/ ___ \| |___| |___
# |_|  |_/_/   \_\_____|_____|
#
lm(LE_2015~., data = LE_d_m_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
lm(HLE_2016~., data = HLE_d_m_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
temp1 <- lm(LE_2015~., data = LE_d_m_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
temp2 <- lm(HLE_2016~., data = HLE_d_m_with_selected_2nd_screen) %>% broom::tidy() %>% filter(p.value<.1)
tt<-bind_rows(temp1[-1, ], temp2[-1, ]) %>% .$term %>%unique() %>%  as.vector()
LE_d_m_with_selected_3rd_screen <- LE_d_common_m %>% bind_cols(LE_d_m[,-1]) %>% select(LE_2015, tt)
HLE_d_m_with_selected_3rd_screen <-HLE_d_common_m %>% bind_cols(HLE_d_m[,-1]) %>% select(HLE_2016, tt)
# 3rd screen data dim info
LE_d_f_with_selected_3rd_screen %>% dim()
HLE_d_f_with_selected_3rd_screen %>% dim()
LE_d_m_with_selected_3rd_screen %>% dim()
HLE_d_m_with_selected_3rd_screen %>% dim()
LE_d_f_with_selected_3rd_screen %>% colnames() %>% cat()
HLE_d_f_with_selected_3rd_screen %>% colnames() %>% cat()
LE_d_m_with_selected_3rd_screen %>% colnames() %>% cat()
HLE_d_m_with_selected_3rd_screen %>% colnames() %>% cat()
# ----------------- ----------------- ----------------- -----------------
#  _____         _   ____                           _
# |___ / _ __ __| | / ___|  ___ _ __ ___  ___ _ __ (_)_ __   __ _
#   |_ \| '__/ _` | \___ \ / __| '__/ _ \/ _ \ '_ \| | '_ \ / _` |
#  ___) | | | (_| |  ___) | (__| | |  __/  __/ | | | | | | | (_| |
# |____/|_|  \__,_| |____/ \___|_|  \___|\___|_| |_|_|_| |_|\__, |
#                                                           |___/
# ----------------- ----------------- ----------------- -----------------
#  _____ _   _ ____
# | ____| \ | |  _ \
# |  _| |  \| | | | |
# | |___| |\  | |_| |
# |_____|_| \_|____/
# ----------------- ----------------- ----------------- -----------------
pref_id<- d_m %>% select(pref.E:pref.J)
d_f_merge_X<-d_common[, 7:104] %>% bind_cols(d_f[, 7:70]) %>% select(-HLE_2016, -LE_2015)
d_m_merge_X<-d_common[, 7:104] %>% bind_cols(d_m[, 7:70]) %>% select(-HLE_2016, -LE_2015)
y_f <- d_f %>% select(LE_2015, HLE_2016)
y_m <- d_m %>% select(LE_2015, HLE_2016)
LE_d_f_final<-LE_d_f_with_selected_3rd_screen
HLE_d_f_final<-HLE_d_f_with_selected_3rd_screen
LE_d_m_final<-LE_d_m_with_selected_3rd_screen
HLE_d_m_final<-HLE_d_m_with_selected_3rd_screen
save.image("ScreenEnd.RData")
ls(list=rm())
rm(list = ls())
load("ScreenEnd.RData")
system("open .")
system("open .")
# devtools::install_github(repo = "luka3117/JcPackage/OsakaUniv2020")
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
suppressMessages(library(ggrepel))
load("ScreenEnd.RData")
LE_d_f_final
lm(LE_d_f_final$LE_2015~. )
lm(LE_2015~. , data = LE_d_f_final)
lm(LE_2015~. , data = LE_d_f_final) %>% broom::tidy()
lm(LE_2015~. , data = LE_d_f_final) %>% broom::glance()
lm(LE_2015~. , data = LE_d_f_final) %>% broom::tidy()
lm(LE_2015~. , data = LE_d_f_final) %>% broom::tidy() %>% DT::datatable()
lm(LE_2015~. , data = LE_d_f_final) %>%
left_join(var, by=c("term"="var_name_Eng"))
lm(LE_2015~. , data = LE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng"))
lm(LE_2015~. , data = LE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(terms, var_name_Jpn, everything())
lm(LE_2015~. , data = LE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything())
lm(LE_2015~. , data = LE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything()) %>% DT::datatable()
system("open .")
var$var_name_Jpn
var$var_name_Jpn
lm(LE_2015~. , data = LE_d_f_final) %>%MASS::stepAIC() %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything()) %>% DT::datatable()
system("open .")
system("open .")
system("open .")
# devtools::install_github(repo = "luka3117/JcPackage/OsakaUniv2020")
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
suppressMessages(library(ggrepel))
suppressMessages(library(magrittr))
load("../ScreenEnd.RData")
# -----------------
# Q1:Do the final regression and interprete : with 4 data
# -----------------
# ----------------- ----------------- ----------------- -----------------
#  _____ _             _   _     __  __
# |  ___(_)_ __   __ _| | | |   |  \/  |
# | |_  | | '_ \ / _` | | | |   | |\/| |
# |  _| | | | | | (_| | | | |___| |  | |
# |_|   |_|_| |_|\__,_|_| |_____|_|  |_|
# ----------------- ----------------- ----------------- -----------------
options(digits = 5)              # Modify global options
lm(LE_2015~. , data = LE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
# -----------------
# Q1:Do the final regression and interprete : with 4 data
# -----------------
# ----------------- ----------------- ----------------- -----------------
#  _____ _             _   _     __  __
# |  ___(_)_ __   __ _| | | |   |  \/  |
# | |_  | | '_ \ / _` | | | |   | |\/| |
# |  _| | | | | | (_| | | | |___| |  | |
# |_|   |_|_| |_|\__,_|_| |_____|_|  |_|
# ----------------- ----------------- ----------------- -----------------
options(digits = 5)              # Modify global options
lm(HLE_2016~. , data = HLE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
# -----------------
# Q1:Do the final regression and interprete : with 4 data
# -----------------
# ----------------- ----------------- ----------------- -----------------
#  _____ _             _   _     __  __
# |  ___(_)_ __   __ _| | | |   |  \/  |
# | |_  | | '_ \ / _` | | | |   | |\/| |
# |  _| | | | | | (_| | | | |___| |  | |
# |_|   |_|_| |_|\__,_|_| |_____|_|  |_|
# ----------------- ----------------- ----------------- -----------------
options(digits = 5)              # Modify global options
lm(LE_2015~. , data = LE_d_m_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
# -----------------
# Q1:Do the final regression and interprete : with 4 data
# -----------------
# ----------------- ----------------- ----------------- -----------------
#  _____ _             _   _     __  __
# |  ___(_)_ __   __ _| | | |   |  \/  |
# | |_  | | '_ \ / _` | | | |   | |\/| |
# |  _| | | | | | (_| | | | |___| |  | |
# |_|   |_|_| |_|\__,_|_| |_____|_|  |_|
# ----------------- ----------------- ----------------- -----------------
options(digits = 5)              # Modify global options
lm(HLE_2016~. , data = HLE_d_m_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
LE_d_f_final.reg<-lm(LE_2015~. , data = LE_d_f_final)
d_f_.FA<-LE_d_f_final.reg$model[,-1] %>% zemi::JcFA()
rownames(d_f_.FA$VAR.rotate)<-colnames(LE_d_f_final.reg$model[,-1] )
d_f_.FA$VAR.rotate %>% data.frame() %>% rownames_to_column() %>%
left_join(var, by=c("rowname"="var_name_Eng")) %>%
select(rowname,var_name_Jpn,X1,X2) %>% rename(F1=X1, F2=X2) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
d_f_.FA$OBS.rotate %>% as.data.frame() %>% tbl_df() %>%
rename(F1=V1, F2=V2) %>%
mutate(pref.J=d_common$pref.J)%>% select(pref.J, everything()) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
#
#
# aa$VAR[,c(1:3)] %>% round(2)
#
#
# plot(aa$OBS.rotate,
#   aa$VAR.rotate)
# DT::datatable()
# aa=zemi::JcFA(zemi::USCrime)
#
# X_f<-LE_d_f_final.reg$model[,-1]
# X_f %>% dim()
#
#
#
# aa$d
# aa=zemi::JcFA(LE_d_f_final[,-1])
#
# HLE_d_f_final %>% colnames()
# #
# # aa$d
# # aa$OBS
# # aa$VAR
#
LE_d_m_final.reg<-lm(LE_2015~. , data = LE_d_m_final)
d_m_.FA<-LE_d_m_final.reg$model[,-1] %>% zemi::JcFA()
rownames(d_m_.FA$VAR.rotate)<-colnames(LE_d_m_final.reg$model[,-1] )
d_m_.FA$VAR.rotate %>% data.frame() %>% rownames_to_column() %>%
left_join(var, by=c("rowname"="var_name_Eng")) %>%
select(rowname,var_name_Jpn,X1,X2) %>% rename(F1=X1, F2=X2) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
d_m_.FA$OBS.rotate %>% as.data.frame() %>% tbl_df() %>%
rename(F1=V1, F2=V2) %>%
mutate(pref.J=d_common$pref.J)%>% select(pref.J, everything()) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
lm(LE_d_f_final$LE_2015~d_f_.FA$OBS.rotate) %>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(LE_d_f_final$LE_2015~d_f_.FA$OBS.rotate) %>% broom::glance()
lm(HLE_d_f_final$HLE_2016~d_f_.FA$OBS.rotate) %>% broom::tidy()%>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(HLE_d_f_final$HLE_2016~d_f_.FA$OBS.rotate) %>% broom::glance()
lm(LE_d_m_final$LE_2015~d_m_.FA$OBS.rotate) %>% broom::tidy()%>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(LE_d_m_final$LE_2015~d_m_.FA$OBS.rotate) %>% broom::glance()
lm(HLE_d_m_final$HLE_2016~d_m_.FA$OBS.rotate) %>% broom::tidy()%>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(HLE_d_m_final$HLE_2016~d_m_.FA$OBS.rotate) %>% broom::glance()
LE_d_f_final$LE_binary <- ifelse(LE_d_f_final$LE_2015>median(LE_d_f_final$LE_2015),1,0)
HLE_d_f_final$HLE_binary <- ifelse(HLE_d_f_final$HLE_2016>median(HLE_d_f_final$HLE_2016),1,0)
LE_d_m_final$LE_binary <- ifelse(LE_d_m_final$LE_2015>median(LE_d_m_final$LE_2015),1,0)
HLE_d_m_final$HLE_binary <- ifelse(HLE_d_m_final$HLE_2016>median(HLE_d_m_final$HLE_2016),1,0)
LE_d_f_final$LE_binary   # 女性
HLE_d_f_final$HLE_binary   # 女性
LE_d_m_final$LE_binary   # 男性
HLE_d_m_final$HLE_binary   # 男性
glm(LE_d_f_final$LE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
glm(HLE_d_f_final$HLE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
glm(LE_d_m_final$LE_binary ~ d_m_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
glm(HLE_d_m_final$HLE_binary ~ d_m_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
glmmML(LE_d_f_final$LE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial", cluster=id)
install.packages("glmmML")
install.packages("glmmML")
library(glmmML)
library(glmmML)
glmmML(LE_d_f_final$LE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial", cluster=id)
LE_d_f_final$LE_binary
d_f_.FA
d_f_.FA$OBS.rotate
LE_binary %>% bind_cols(d_f_.FA$OBS.rotate)
LE_binary
LE_d_f_final$LE_binary
LE_d_f_final$LE_binary %>% bind_cols(d_f_.FA$OBS.rotate)
LE_d_f_final$LE_binary
LE_d_f_final$LE_binary %>% enframe()
LE_d_f_final$LE_binary %>% enframe() %>% bind_cols(d_f_.FA$OBS.rotate)
LE_d_f_final$LE_binary %>% enframe() %>%  data_frame(bind_cols(d_f_.FA$OBS.rotate))
data_frame(bind_cols(d_f_.FA$OBS.rotate))
data_frame(bind_cols(d_f_.FA$OBS.rotate))
data_frame(d_f_.FA$OBS.rotate)
as.data.frame(d_f_.FA$OBS.rotate)
LE_d_f_final$LE_binary %>% enframe() %>%  bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
LE_d_f_final$LE_binary %>% enframe() %>% as.factor()
LE_d_f_final$LE_binary %>% enframe()
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
LE_d_f_final$LE_binary
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
%>% rename(LE_binary=value,F1=V1, F2=V2) %>%
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
%>% rename(LE_binary=value,F1=V1, F2=V2) %>% mutate(LE_binary=as.factor(LE_binary))
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
%>% rename(LE_binary=value,F1=V1, F2=V2) %>% mutate(LE_binary=as.factor(.$LE_binary))
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
%>% rename(LE_binary=value,F1=V1, F2=V2) %>% mutate(LE_binary=as.factor(LE_binary))
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))
%>% rename(LE_binary=value,F1=V1, F2=V2) %>% mutate(LE_binary=as.factor(LE_binary))
LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))%>% rename(LE_binary=value,F1=V1, F2=V2) %>% mutate(LE_binary=as.factor(LE_binary))
aaaa=LE_d_f_final$LE_binary %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))%>% rename(LE_binary=value,F1=V1, F2=V2) %>% mutate(LE_binary=as.factor(LE_binary))
glmmML(LE_binary ~ F1+F2, family =  "binomial", cluster=id, data=aaaa)
glmmML(LE_binary ~ F1+F2, family =  "binomial", cluster=name, data=aaaa)
glm(LE_d_f_final$LE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")
system("open .")
system("open .")
?glmmML
help(package = "glmmML")
id <- factor(rep(1:20, rep(5, 20)))
y <- rbinom(100, prob = rep(runif(20), rep(5, 20)), size = 1)
x <- rnorm(100)
dat <- data.frame(y = y, x = x, id = id)
dat
glmmML(y ~ x, data = dat, cluster = id)
library(glmmML)
glmmML(y ~ x, data = dat, cluster = id)
id <- factor(rep(1:20, rep(5, 20)))
y <- rbinom(100, prob = rep(runif(20), rep(5, 20)), size = 1)
x <- rnorm(100)
dat <- data.frame(y = y, x = x, id = id)
dat
