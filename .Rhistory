suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
library(xtable)
## ----tex file sink example ------------------------------
# table tex saving folder
path="./final_report-kenko(和歌山県)/table/"
# table tex file name
file="example.tex"
sink(file = paste0(path, file))
xtable(iris[1:5, ], label = "tablelabel", caption = c(
"$\\beta_0
X_1+
\\beta_0 X_2$
寿命", "bbb")) %>% print(size="\\tiny")
sink()
# # -----------------
#  ____           __  __       _            _       _
# |  _ \ _ __ ___|  \/  | __ _| |_ ___ _ __(_) __ _| |
# | |_) | '__/ _ \ |\/| |/ _` | __/ _ \ '__| |/ _` | |
# |  __/| | |  __/ |  | | (_| | ||  __/ |  | | (_| | |
# |_|   |_|  \___|_|  |_|\__,_|\__\___|_|  |_|\__,_|_|
# # -----------------
# 使用package
suppressMessages(library(readxl))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(kableExtra))
suppressMessages(library(curl))
suppressMessages(library(tidyverse))
suppressMessages(library(plotly))
suppressMessages(library(ggrepel))
suppressMessages(library(magrittr))
# load("../ScreenEnd.RData")
load("ScreenEnd.RData")
f_var=LE_d_f_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(f_var=var_name_Jpn) %>% .[-1, ]
m_var=LE_d_m_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(m_var=var_name_Jpn) %>% .[-1, ]
m_var %<>% bind_rows(as.data.frame(rep(NA, 7)))
m_var %<>% select(1)
LE_d_m_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3) %>% filter(!is.na(var_name_Jpn)) %>% rename(female_var=var_name_Jpn) %>% .[-1, ]
LE_d_m_final %>% colnames() %>% tbl_df() %>% left_join(var, by=c("value"="var_name_Eng")) %>%
select(3)
options(digits = 5)              # Modify global options
fit_with_X_lm_LE_d_f<-lm(LE_2015~. , data = LE_d_f_final)
lm(LE_2015~. , data = LE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
fit_with_X_lm_LE_d_m<-lm(LE_2015~. , data = LE_d_m_final)
lm(LE_2015~. , data = LE_d_m_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
options(digits = 5)              # Modify global options
fit_with_X_lm_HLE_d_f<-lm(HLE_2016~. , data = HLE_d_f_final)
lm(HLE_2016~. , data = HLE_d_f_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
fit_with_X_lm_HLE_d_m<-lm(HLE_2016~. , data = HLE_d_m_final)
lm(HLE_2016~. , data = HLE_d_m_final) %>%
broom::tidy() %>%
left_join(var, by=c("term"="var_name_Eng")) %>%
select(term, var_name_Jpn, everything(), -id,- address, -std.error, -columm_letter ) %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'statistic', "p.value"), digits=3)
## ----warning=FALSE------------------------------
LE_d_f_final.reg<-lm(LE_2015~. , data = LE_d_f_final)
d_f_.FA<-LE_d_f_final.reg$model[,-1] %>% zemi::JcFA()
rownames(d_f_.FA$VAR.rotate)<-colnames(LE_d_f_final.reg$model[,-1] )
d_f_.FA$VAR.rotate %>% data.frame() %>% rownames_to_column() %>%
left_join(var, by=c("rowname"="var_name_Eng")) %>%
select(rowname,var_name_Jpn,X1,X2) %>% rename(F1=X1, F2=X2) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
## ----warning=FALSE------------------------------
d_f_.FA$OBS.rotate %>% as.data.frame() %>% tbl_df() %>%
rename(F1=V1, F2=V2) %>%
mutate(pref.J=d_common$pref.J)%>% select(pref.J, everything()) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
## ----warning=FALSE------------------------------
LE_d_m_final.reg<-lm(LE_2015~. , data = LE_d_m_final)
d_m_.FA<-LE_d_m_final.reg$model[,-1] %>% zemi::JcFA()
rownames(d_m_.FA$VAR.rotate)<-colnames(LE_d_m_final.reg$model[,-1] )
d_m_.FA$VAR.rotate %>% data.frame() %>% rownames_to_column() %>%
left_join(var, by=c("rowname"="var_name_Eng")) %>%
select(rowname,var_name_Jpn,X1,X2) %>% rename(F1=X1, F2=X2) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
## ----warning=FALSE------------------------------
d_m_.FA$OBS.rotate %>% as.data.frame() %>% tbl_df() %>%
rename(F1=V1, F2=V2) %>%
mutate(pref.J=d_common$pref.J)%>% select(pref.J, everything()) %>%
DT::datatable() %>% DT::formatRound(columns=c('F1', 'F2'), digits=3)
## ----warning=FALSE------------------------------
fit_with_FA_lm_LE_d_f<-lm(LE_d_f_final$LE_2015~d_f_.FA$OBS.rotate)
lm(LE_d_f_final$LE_2015~d_f_.FA$OBS.rotate) %>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(LE_d_f_final$LE_2015~d_f_.FA$OBS.rotate) %>% broom::glance()
## ----warning=FALSE------------------------------
fit_with_FA_lm_LE_d_m<-lm(LE_d_m_final$LE_2015~d_m_.FA$OBS.rotate)
lm(LE_d_m_final$LE_2015~d_m_.FA$OBS.rotate) %>% broom::tidy()%>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(LE_d_m_final$LE_2015~d_m_.FA$OBS.rotate) %>% broom::glance()
## ----warning=FALSE------------------------------
fit_with_FA_lm_HLE_d_f<-lm(HLE_d_f_final$HLE_2016~d_f_.FA$OBS.rotate)
lm(HLE_d_f_final$HLE_2016~d_f_.FA$OBS.rotate) %>% broom::tidy()%>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(HLE_d_f_final$HLE_2016~d_f_.FA$OBS.rotate) %>% broom::glance()
## ----warning=FALSE------------------------------
fit_with_FA_lm_HLE_d_m<-lm(HLE_d_m_final$HLE_2016~d_m_.FA$OBS.rotate)
lm(HLE_d_m_final$HLE_2016~d_m_.FA$OBS.rotate) %>% broom::tidy()%>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
lm(HLE_d_m_final$HLE_2016~d_m_.FA$OBS.rotate) %>% broom::glance()
## ----warning=FALSE------------------------------
LE_FF_d_f=LE_d_f_final$LE_2015 %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))%>%
rename(LE=value,F1=V1, F2=V2) %>% select(-name)
fit_with_FA_gamma_LE_d_f<-glm(LE~., family=Gamma(link="log"), data=LE_FF_d_f)
glm(LE~., family=Gamma(link="log"), data=LE_FF_d_f) %>%
broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
## ----warning=FALSE------------------------------
LE_FF_d_m=LE_d_m_final$LE_2015 %>% enframe() %>%
bind_cols(as.data.frame(d_m_.FA$OBS.rotate))%>%
rename(LE=value,F1=V1, F2=V2) %>% select(-name)
fit_with_FA_gamma_LE_d_m<-glm(LE~., family=Gamma(link="log"), data=LE_FF_d_m)
glm(LE~., family=Gamma(link="log"), data=LE_FF_d_m) %>%
broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
## ----warning=FALSE------------------------------
HLE_FF_d_f=HLE_d_f_final$HLE_2016 %>% enframe() %>%
bind_cols(as.data.frame(d_f_.FA$OBS.rotate))%>%
rename(HLE=value,F1=V1, F2=V2) %>% select(-name)
fit_with_FA_gamma_HLE_d_f<-
glm(HLE~., family=Gamma(link="log"), data=HLE_FF_d_f)
glm(HLE~., family=Gamma(link="log"), data=HLE_FF_d_f) %>%
broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
## ----warning=FALSE------------------------------
HLE_FF_d_m=HLE_d_m_final$HLE_2016 %>% enframe() %>%
bind_cols(as.data.frame(d_m_.FA$OBS.rotate))%>%
rename(HLE=value,F1=V1, F2=V2) %>% select(-name)
fit_with_FA_gamma_HLE_d_m<-glm(HLE~., family=Gamma(link="log"), data=HLE_FF_d_m)
glm(HLE~., family=Gamma(link="log"), data=HLE_FF_d_m) %>%
broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
sink(file = paste0(path, file))
sink()
sink()
sink()
## ----warning=FALSE------------------------------
LE_d_f_final$LE_binary <- ifelse(LE_d_f_final$LE_2015>median(LE_d_f_final$LE_2015),1,0)
HLE_d_f_final$HLE_binary <- ifelse(HLE_d_f_final$HLE_2016>median(HLE_d_f_final$HLE_2016),1,0)
LE_d_m_final$LE_binary <- ifelse(LE_d_m_final$LE_2015>median(LE_d_m_final$LE_2015),1,0)
HLE_d_m_final$HLE_binary <- ifelse(HLE_d_m_final$HLE_2016>median(HLE_d_m_final$HLE_2016),1,0)
fit_with_FA_logit_LE_d_f<-glm(LE_d_f_final$LE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")
glm(LE_d_f_final$LE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
## ----warning=FALSE------------------------------
fit_with_FA_logit_LE_d_m<-glm(LE_d_m_final$LE_binary ~ d_m_.FA$OBS.rotate, family =  "binomial")
glm(LE_d_m_final$LE_binary ~ d_m_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
## ----warning=FALSE------------------------------
fit_with_FA_logit_HLE_d_f<-glm(HLE_d_f_final$HLE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy()
glm(HLE_d_f_final$HLE_binary ~ d_f_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
fit_with_FA_logit_HLE_d_m<-glm(HLE_d_m_final$HLE_binary ~ d_m_.FA$OBS.rotate, family =  "binomial")
glm(HLE_d_m_final$HLE_binary ~ d_m_.FA$OBS.rotate, family =  "binomial")%>% broom::tidy() %>% DT::datatable() %>% DT::formatRound(columns=c('estimate', 'std.error', 'statistic', 'p.value'), digits=3)
file="table_logit_HLE_FA_m.tex"
## ---- Bayes ------------------------------
## ---- Bayes : 女性、平均寿命---------------
## ----warning=FALSE------------------------------
suppressMessages(library(rethinking))
Bayes_fit_LE_d_f<-
rethinking::map(alist( LE~dnorm(mu, sigma), mu~beta0+beta1*F1+beta2*F2, beta0~dnorm(80, 100), beta1~dnorm(0, 10), beta2~dnorm(0, 10), sigma ~ dunif(0, 50)),
data=LE_FF_d_f
)
## ----warning=FALSE------------------------------
precis(Bayes_fit_LE_d_f) %>% DT::datatable() %>% DT::formatRound(columns=c("mean", "sd","5.5%","94.5%"), digits=3)
precis(Bayes_fit_LE_d_f) %>% as.matrix() %>% as.data.frame()
post<-extract.samples(Bayes_fit_LE_d_f)
dens(post)
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*mean(LE_FF_d_f$F1)+ post$beta2*quantile(LE_FF_d_f$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(LE_FF_d_f$F1)+ post$beta2*quantile(LE_FF_d_f$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(LE_FF_d_f$F1)+ post$beta2*quantile(LE_FF_d_f$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "(女性平均寿命)F2因子の寿命分布への影響", xlim=c(86.8, 87.2))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(86.8, 87.2)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) %>%
ggtitle("aaa")
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("aaa")
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命、女性")
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命、女性")
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(LE_FF_d_f$F1)[2]+ post$beta2*mean(LE_FF_d_f$F2)
mu_at_Q3<-post$beta0 + post$beta1*quantile(LE_FF_d_f$F1)[3]+ post$beta2*mean(LE_FF_d_f$F2)
mu_at_Q4<-post$beta0 + post$beta1*quantile(LE_FF_d_f$F1)[4]+ post$beta2*mean(LE_FF_d_f$F2)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(86.8, 87.2)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命のF1による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_f_ccdf_F1.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
suppressMessages(library(rethinking))
Bayes_fit_LE_d_m<-
rethinking::map(alist( LE~dnorm(mu, sigma), mu~beta0+beta1*F1+beta2*F2, beta0~dnorm(80, 100), beta1~dnorm(0, 10), beta2~dnorm(0, 10), sigma ~ dunif(0, 50)),
data=LE_FF_d_m
)
## ----warning=FALSE------------------------------
precis(Bayes_fit_LE_d_m)
precis(Bayes_fit_LE_d_m) %>% as.matrix() %>% as.data.frame()
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*mean(LE_FF_d_m$F1)+ post$beta2*quantile(LE_FF_d_m$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(LE_FF_d_m$F1)+ post$beta2*quantile(LE_FF_d_m$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(LE_FF_d_m$F1)+ post$beta2*quantile(LE_FF_d_m$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(80-.0, 80+1))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(80-.0, 80+1)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命のF2による影響、男性")+theme_bw()
suppressMessages(library(rethinking))
Bayes_fit_LE_d_m<-
rethinking::map(alist( LE~dnorm(mu, sigma), mu~beta0+beta1*F1+beta2*F2, beta0~dnorm(80, 100), beta1~dnorm(0, 10), beta2~dnorm(0, 10), sigma ~ dunif(0, 50)),
data=LE_FF_d_m
)
Bayes_fit_LE_d_m
precis(Bayes_fit_LE_d_m)
precis(Bayes_fit_LE_d_m) %>% as.matrix() %>% as.data.frame()
post<-extract.samples(Bayes_fit_LE_d_m)
dens(post)
mu_at_Q2<-post$beta0 + post$beta1*mean(LE_FF_d_m$F1)+ post$beta2*quantile(LE_FF_d_m$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(LE_FF_d_m$F1)+ post$beta2*quantile(LE_FF_d_m$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(LE_FF_d_m$F1)+ post$beta2*quantile(LE_FF_d_m$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(80-.0, 80+1))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
aa
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(80-.0, 80+1)
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("平均寿命のF2による影響、男性")+theme_bw()
aa_plot
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(80-.0, 80+1) +
ggtitle("平均寿命のF2による影響、男性")+theme_bw()
aa_plot
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_m_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
mu_at_Q2<-post$beta0 + post$beta1*quantile(LE_FF_d_m$F1)[2]+ post$beta2*mean(LE_FF_d_m$F2)
mu_at_Q3<-post$beta0 + post$beta1*quantile(LE_FF_d_m$F1)[3]+ post$beta2*mean(LE_FF_d_m$F2)
mu_at_Q4<-post$beta0 + post$beta1*quantile(LE_FF_d_m$F1)[4]+ post$beta2*mean(LE_FF_d_m$F2)
mu_at_Q2 %>% dens(col="red", main = "F1因子の寿命への影響", xlim=c(80-.0, 80+1))
mu_at_Q3 %>% dens(col="green", main = "F1が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F1が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(80-.0, 80+1)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(80-.0, 80+1)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(80-.0, 80+1) +
ggtitle("平均寿命のF1による影響、男性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_LE_m_ccdf_F1.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
suppressMessages(library(rethinking))
Bayes_fit_HLE_d_f<-
rethinking::map(alist(HLE~dnorm(mu, sigma),mu~beta0+beta1*F1+beta2*F2,beta0~dnorm(80, 100),beta1~dnorm(0, 10),beta2~dnorm(0, 10),sigma ~ dunif(0, 50)),
data=HLE_FF_d_f
)
## ----warning=FALSE------------------------------
precis(Bayes_fit_HLE_d_f)
precis(Bayes_fit_HLE_d_f) %>% as.matrix() %>% as.data.frame()
suppressMessages(library(rethinking))
Bayes_fit_HLE_d_f<-
rethinking::map(alist(HLE~dnorm(mu, sigma),mu~beta0+beta1*F1+beta2*F2,beta0~dnorm(80, 100),beta1~dnorm(0, 10),beta2~dnorm(0, 10),sigma ~ dunif(0, 50)),
data=HLE_FF_d_f
)
precis(Bayes_fit_HLE_d_f)
precis(Bayes_fit_HLE_d_f) %>% as.matrix() %>% as.data.frame()
Bayes_fit_HLE_d_f<-
rethinking::map(alist(HLE~dnorm(mu, sigma),mu~beta0+beta1*F1+beta2*F2,beta0~dnorm(80, 100),beta1~dnorm(0, 10),beta2~dnorm(0, 10),sigma ~ dunif(0, 50)),
data=HLE_FF_d_f
)
Bayes_fit_HLE_d_f
precis(Bayes_fit_HLE_d_f)
precis(Bayes_fit_HLE_d_f) %>% as.matrix() %>% as.data.frame()
post<-extract.samples(Bayes_fit_HLE_d_f)
dens(post)
dens(post)
mu_at_Q2<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(75-.3, 75+.3))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(75-.3, 75+.3) +
ggtitle("健康寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[2]+ post$beta2*mean(HLE_FF_d_f$F2)
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(HLE_FF_d_f$F1)+ post$beta2*quantile(HLE_FF_d_f$F2)[4]
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(75-.3, 75+.3))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(86.8, 87.2) +
ggtitle("健康寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(75-.3, 75+.3) +
ggtitle("健康寿命のF2による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[2]+ post$beta2*mean(HLE_FF_d_f$F2)
mu_at_Q3<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[3]+ post$beta2*mean(HLE_FF_d_f$F2)
mu_at_Q4<-post$beta0 + post$beta1*quantile(HLE_FF_d_f$F1)[4]+ post$beta2*mean(HLE_FF_d_f$F2)
par(family= "HiraKakuProN-W3")
mu_at_Q2 %>% dens(col="red", main = "F1因子の寿命への影響", xlim=c(75-.3, 75+.3))
mu_at_Q3 %>% dens(col="green", main = "F1が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F1が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(75-.3, 75+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(75-.3, 75+.3) +
ggtitle("健康寿命のF1による影響、女性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_f_ccdf_F1.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ---- Bayes : 男性、健康寿命---------------
suppressMessages(library(rethinking))
suppressMessages(library(rethinking))
Bayes_fit_HLE_d_m<-
rethinking::map(alist(HLE~dnorm(mu, sigma),mu~beta0+beta1*F1+beta2*F2,beta0~dnorm(80, 100),beta1~dnorm(0, 10),beta2~dnorm(0, 10),sigma ~ dunif(0, 50)),
data=HLE_FF_d_m
)
## ----warning=FALSE------------------------------
precis(Bayes_fit_HLE_d_m)
precis(Bayes_fit_HLE_d_m) %>% as.matrix() %>% as.data.frame()
file="Bayes_fit_HLE_d_m.tex"
post<-extract.samples(Bayes_fit_HLE_d_m)
dens(post)
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*mean(HLE_FF_d_m$F1)+ post$beta2*quantile(HLE_FF_d_m$F2)[2]
mu_at_Q3<-post$beta0 + post$beta1*mean(HLE_FF_d_m$F1)+ post$beta2*quantile(HLE_FF_d_m$F2)[3]
mu_at_Q4<-post$beta0 + post$beta1*mean(HLE_FF_d_m$F1)+ post$beta2*quantile(HLE_FF_d_m$F2)[4]
par(family= "HiraKakuProN-W3")
mu_at_Q2 %>% dens(col="red", main = "F2因子の寿命分布への影響", xlim=c(72-.3, 72+.3))
mu_at_Q3 %>% dens(col="green", main = "F2が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F2が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(72-.3, 72+.3)
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(72-.3, 72+.3) +
ggtitle("健康寿命のF2による影響、男性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_m_ccdf_F2.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
## ----warning=FALSE------------------------------
mu_at_Q2<-post$beta0 + post$beta1*quantile(HLE_FF_d_m$F1)[2]+ post$beta2*mean(HLE_FF_d_m$F2)
mu_at_Q3<-post$beta0 + post$beta1*quantile(HLE_FF_d_m$F1)[3]+ post$beta2*mean(HLE_FF_d_m$F2)
mu_at_Q4<-post$beta0 + post$beta1*quantile(HLE_FF_d_m$F1)[4]+ post$beta2*mean(HLE_FF_d_m$F2)
par(family= "HiraKakuProN-W3")
mu_at_Q2 %>% dens(col="red", main = "F1因子の寿命への影響", xlim=c(72-.3, 72+.3))
mu_at_Q3 %>% dens(col="green", main = "F1が Q3である場合", add = T)
mu_at_Q4 %>% dens(col="blue", main = "F1が Q4である場合", add = T)
aa<-tibble::tibble(
mu_at_Q2=mu_at_Q2,
mu_at_Q3=mu_at_Q3,
mu_at_Q4=mu_at_Q4
) %>% pivot_longer(cols = everything()) %>% nest(value)
name <- function(aa) {
ggplot_build(aa %>% ggplot(aes(value))+stat_ecdf())$data[[1]] %>% select(y, x) %>%
mutate(ccdf=1-y)
}
aa$ccdf<-purrr::map(aa$data, name)
aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+theme_bw(base_family = "HiraKakuProN-W3")+xlim(72-.3, 72+.3)
# insert start-----------------
aa_plot<-aa %>% unnest(cols = ccdf) %>% ggplot(aes(x=x, y=ccdf, group=name, color=name))+geom_line()+xlim(72-.3, 72+.3) +
ggtitle("健康寿命のF1による影響、男性")+theme_bw()
path="./final_report-kenko(和歌山県)/fig/"
file="Bayes_HLE_m_ccdf_F1.pdf"
# ggsave(filename = paste0(path, file),aa,width = 8, height = 8, family="Japan1")
ggsave(filename = paste0(path, file),aa_plot, family="Japan1")
